# 介绍

搜索与分析

Kibana 一款对elasticsearch可视化的工具

当有以下场景则很可能用到elasticsearch：
* 给你的应用作为搜索工具
* 分析日志 指标 安全事件的工具
* 机器学习建模
* 自动化业务工作流
* GIS
* 生物学信息分析


## 存放的数据 document indices

>  Elasticsearch 作为一个分布式文档存储，而不是把信息存为多行的柱列式数据库，它能存储复杂的数据结构，只要被序列化为Json的文档。Elasticsearch可以组成一个集群，可以在整个集群中存储也可以从任意节点获取数据。
  当一个文档被存储了，就会被索引并且，在一秒内查出。其倒排索引支持全文搜索。倒排索引列出某个词在哪些文档中出现过。
  索引可以被看成是文档的优化集合，每个文档由一个集合的字段域组成，字段域是 key-value 型存储你的数据。Elasticsearch默认对每个字段进行索引，且每个域都有专门的优化的数据结构。例如：文本域被存储为倒排索引，数字的和地理上的数据则存为BKD树。搜索时，利用这些数据结构去搜集并返回数据是很快的。
  它还具有无模式的能力，这意味着对文档建索引时无需对某些字段特指处理方式。当动态的mapping功能开启后，Elasticsearch自动检测并添加新的域到索引中。例如布尔值，浮点等都会在Elasticsearch匹配相应的数据类型。
  还可以定义规则动态的映射字段域们如何存储与建索引。
  定义自己的mapping有以下好处:
    区分全文字符串字段和精确值字符串字段
    执行特定于语言的文本分析
    优化字段以进行部分匹配
    使用自定义日期格式
    使用无法自动检测到的 数据类型，例如geo_point和geo_shape
  为不同的目的以不同的方式对同一字段建立索引通常很有用。例如，您可能希望将一个字符串字段索引为全文搜索的文本字段，以及作为排序或汇总数据的关键字字段。或者，您可能选择使用多个语言分析器来处理包含用户输入的字符串字段的内容。
  在搜索时也会使用在索引期间应用于全文字段的分析链。当您查询全文字段时，对查询文本进行相同的分析，然后再在索引中查找术语。
  
  
  
  
## 搜索的数据 搜索 分析

可以使用结构化得查询语言，Elasticsearch的查询语言叫  Query DSL  , 类似sql的语句让Elasticsearch 在内部聚合出你所需要的数据。
除了在一堆干草堆中找出那一根根针，Elasticsearch 还能分析这些针的特色，与众不同。

## 可扩展性 恢复性：集群 节点 分片

>  Elasticsearch 可根据你的需要决定规模。他支持分布式！无需重复修改应用，Elasticsearch 知道怎样平衡各个节点以达到高可用。
  为何这么厉害，其实Elasticsearch 的 索引只是物理分片上的逻辑组，而物理分片实际上有自我索引。把文档分成多个片，多个片放在多个节点上。达到冗余：以解决物理机坏掉，大量查询时缓解压力。当集群加大或收缩时，Elasticsearch能自动迁移分片以达到集群的平衡。
  分片有两种类型：主分片，复制分片。每个文档只要一个主片，复制分片从主分片出。复制分片用来冗余的。
  索引创建时，主分片的数量也就固定了。而复制片却可能随时变化也不影响功能。
  
>  It Depends...
  索引的分片和主分片的配置需要考虑权衡一些性能。因为片不是越多越好，也不是越大越好。维护代价大。
  数据片越少，单个查询越快。很多的一起查就慢。
    一般片的大小分成十几GB，而一些时间类的数据 20到40GB
    为了避免分太多的片，is proportional to成比例，可用空间。每GB的片数应小于20.
    这有个讲座告诉你该怎么办：https://www.elastic.co/cn/elasticon/conf/2016/sf/quantitative-cluster-sizing
    
>  集群是在同一个网络中的。平衡集群中的片数就花好多时间。请不要把鸡蛋放一个篮子里，比如停电了，无缝接管？。CCR 跨集群复制
   CCR通过主片复制到另外一个集群达到热备。还能让用户就近读取。
   跨集群复制是主动-被动关系。所有写请求由主集群来做，复制集群跟着复制过去。

   使用Kibana 管理Elasticsearch数据。
